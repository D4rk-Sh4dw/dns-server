version: '3.8'

services:
  # --- Central Management Dashboard ---
  dashboard:
    image: ghcr.io/d4rk-sh4dw/dns-frontend:latest
    container_name: dns-dashboard
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - ADGUARD_URL=http://dns-adguard:3000
      - ADGUARD_USER=admin
      - ADGUARD_PASS=admin123
      - TECHNITIUM_URL=http://dns-technitium:5380
      - TECHNITIUM_PASSWORD=admin123
    depends_on:
      - adguard
      - technitium
    networks:
      - dns-net

  # --- AdGuard Home (Recursive DNS & AdBlocking) ---
  adguard:
    image: adguard/adguardhome:latest
    container_name: dns-adguard
    restart: unless-stopped
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "3001:3000/tcp"
    volumes:
      - ./data/adguard/work:/opt/adguardhome/work
      - ./config/adguard:/opt/adguardhome/conf
    networks:
      - dns-net

  # --- Technitium DNS (Authoritative DNS) ---
  technitium:
    image: technitium/dns-server:latest
    container_name: dns-technitium
    restart: unless-stopped
    ports:
      - "5380:5380/tcp"
    environment:
      - DNS_SERVER_DOMAIN=dns.local
      - DNS_SERVER_ADMIN_PASSWORD=admin123
      - DNS_SERVER_PREFER_IPV6=false
      - DNS_SERVER_FORWARDERS=1.1.1.1,8.8.8.8
    volumes:
      - ./data/technitium:/etc/dns
    networks:
      - dns-net

networks:
  dns-net:
    driver: bridge
