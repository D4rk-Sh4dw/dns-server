version: '3.8'

services:
  # --- Central Management Dashboard (Our new app) ---
  # --- Central Management Dashboard (Our new app) ---
  dashboard:
    image: ghcr.io/d4rk-sh4dw/dns-frontend:latest
    # build: ./frontend
    container_name: dns-dashboard
    ports:
      - "3000:3000"
    environment:
      - ADGUARD_URL=http://dns-adguard:80 # Port 80 inside container maps to 3001 outside? No, wait. 
      # AdGuard image usually exposes 80 inside. 
      # Let's check adguard documentation mapping. 
      # "3001:80/tcp" means host 3001 -> container 80.
      # So internal URL is http://dns-adguard:80
      - TECHNITIUM_URL=http://dns-technitium:5380
    depends_on:
      - adguard
      - technitium
    networks:
      - dns-management-net

  # --- AdGuard Home (Recursive DNS & AdBlocking) ---
  adguard:
    image: adguard/adguardhome:latest
    container_name: dns-adguard
    restart: unless-stopped
    ports:
      - "53:53/tcp"
      - "53:53/udp"
      - "3001:80/tcp" # AdGuard Web Interface
      - "3001:3000/tcp" # AdGuard Setup (Initial)
    volumes:
      - ./data/adguard/work:/opt/adguardhome/work
      - ./data/adguard/conf:/opt/adguardhome/conf
    networks:
      - dns-management-net

  # --- Technitium DNS (Authoritative DNS) ---
  technitium:
    image: technitium/dns-server:latest
    container_name: dns-technitium
    restart: unless-stopped
    ports:
      - "5380:5380/tcp" # Technitium Web Console
      # Note: Port 53 is taken by AdGuard. 
      # Technitium will run on a different internal port or interface.
      # For now, we just expose the management port.
      # In a real setup, we might forward specific high-level domains to it
      # or expose it on a secondary IP.
    environment:
      - DNS_SERVER_DOMAIN=dns-server # Optional
    volumes:
      - ./data/technitium:/etc/dns
    networks:
      - dns-management-net

networks:
  dns-management-net:
    driver: bridge
