version: '3.8'

services:
  # --- Central Management Dashboard ---
  dashboard:
    image: ghcr.io/d4rk-sh4dw/dns-frontend:latest
    container_name: dns-dashboard
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - ADGUARD_URL=http://localhost:3001
      - ADGUARD_USER=admin
      - ADGUARD_PASS=admin123
      - TECHNITIUM_URL=http://localhost:5380
      - TECHNITIUM_PASSWORD=admin123
    network_mode: host
    depends_on:
      - adguard
      - technitium

  # --- AdGuard Home (Recursive DNS & AdBlocking) ---
  adguard:
    image: adguard/adguardhome:latest
    container_name: dns-adguard
    restart: unless-stopped
    network_mode: host # Uses host network directly - solves DNS routing issues
    volumes:
      - ./data/adguard/work:/opt/adguardhome/work
      - ./config/adguard:/opt/adguardhome/conf

  # --- Technitium DNS (Authoritative DNS) ---
  technitium:
    image: technitium/dns-server:latest
    container_name: dns-technitium
    restart: unless-stopped
    network_mode: host # Uses host network directly
    environment:
      - DNS_SERVER_DOMAIN=dns.local
      - DNS_SERVER_ADMIN_PASSWORD=admin123
      - DNS_SERVER_PREFER_IPV6=false
      - DNS_SERVER_FORWARDERS=1.1.1.1,8.8.8.8
      - DNS_SERVER_WEB_SERVICE_HTTP_PORT=5380
      - DNS_SERVER_OPTIONAL_PROTOCOL_DNS_OVER_UDP=5353 # Avoid port 53 conflict with AdGuard
    volumes:
      - ./data/technitium:/etc/dns
